<div
  id="tile-{{ id }}"
  tabindex="0"
  (keyup.enter)="click()"
  [ngClass]="{ playing: starting }"
  (click)="click()"
  class="content-card"
  (contextmenu)="onRightClick($event)"
>
  <!-- Thumbnail -->
  <div class="thumbnail-container">
    <img
      (error)="showImage = false"
      class="thumbnail-image"
      *ngIf="channel?.image && showImage"
      src="{{ channel?.image }}"
      [alt]="channel?.name"
    />
    <div *ngIf="!channel?.image || !showImage" class="thumbnail-placeholder">
      <span>{{ channel?.name?.charAt(0)?.toUpperCase() }}</span>
    </div>

    <!-- Status badge -->
    <div class="status-badge" *ngIf="channel?.media_type !== undefined">
      <div class="status-dot"></div>
      <span class="status-text">{{ getMediaTypeLabel() }}</span>
    </div>

    <!-- Archive indicator -->
    <div class="archive-badge" *ngIf="channel?.tv_archive === true">
      <svg
        fill="currentColor"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        class="archive-icon"
      >
        <path
          d="M20 6H2V2H20V6M16.5 12H15V17L18.61 19.16L19.36 17.94L16.5 16.25V12M23 16C23 19.87 19.87 23 16 23C13.62 23 11.53 21.81 10.26 20H3V7H19V9.68C21.36 10.81 23 13.21 23 16M8 12H10.26C10.83 11.19 11.56 10.5 12.41 10H8.5C8.22 10 8 10.22 8 10.5V12M21 16C21 13.24 18.76 11 16 11S11 13.24 11 16 13.24 21 16 21 21 18.76 21 16Z"
        />
      </svg>
    </div>
  </div>

  <!-- Content info -->
  <div class="content-info">
    <div class="content-text">
      <h3 class="content-title" [title]="channel?.name">{{ channel?.name }}</h3>
      <p class="content-subtitle" *ngIf="getSubtitle()">{{ getSubtitle() }}</p>
    </div>

    <button
      class="menu-button"
      (click)="onMenuClick($event)"
      [attr.aria-label]="'Options for ' + channel?.name"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="menu-icon"
      >
        <circle cx="12" cy="12" r="1"></circle>
        <circle cx="12" cy="5" r="1"></circle>
        <circle cx="12" cy="19" r="1"></circle>
      </svg>
    </button>
  </div>
</div>

<div
  style="visibility: hidden; position: fixed"
  [style.left.px]="menuTopLeftPosition.x"
  [style.top.px]="menuTopLeftPosition.y"
  [matMenuTriggerFor]="rightMenu"
></div>

<mat-menu #rightMenu="matMenu">
  <ng-template matMenuContent let-item="item">
    <button
      [hidden]="
        channel?.media_type == mediaTypeEnum.group || channel?.media_type == mediaTypeEnum.season
      "
      mat-menu-item
      (click)="favorite()"
    >
      <ng-container *ngIf="alreadyExistsInFav">Unfavorite</ng-container>
      <ng-container *ngIf="!alreadyExistsInFav">Favorite</ng-container>
    </button>
    <button [hidden]="!isLivestream()" mat-menu-item (click)="record()">Record</button>
    <button [hidden]="!isMovie() || downloading" mat-menu-item (click)="downloadVod()">
      Download
    </button>
    <button [hidden]="!isMovie() || !downloading" mat-menu-item (click)="cancelDownload()">
      Cancel download
    </button>
    <button [hidden]="!showEPG()" mat-menu-item (click)="showEPGModal()">EPG</button>
    <button [hidden]="!isCustom()" mat-menu-item (click)="edit()">Edit</button>
    <button [hidden]="!isCustom()" mat-menu-item (click)="share()">Share</button>
    <button [hidden]="!isLivestream()" mat-menu-item (click)="openRestreamModal()">
      Re-stream
    </button>
    <button [hidden]="!isCustom()" mat-menu-item (click)="delete()">Delete</button>
  </ng-template>
</mat-menu>
